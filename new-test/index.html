<!doctype html>
<html>

<head>
    <title>Realtime 3D Audio</title>
    <style>
        body {
            font-family: sans-serif;
            padding: 20px;
            background: #222;
            color: #fff;
        }

        .control {
            margin: 10px 0;
        }

        label {
            display: inline-block;
            width: 30px;
        }
    </style>
</head>

<body>
    <h2>3D Audio Positioner</h2>
    <button onclick="initAudio()">Start Audio</button>

    <div class="control">
        <label>X</label>
        <input type="range" min="-10" max="10" step="0.1" value="0" oninput="updatePos('x', this.value)" />
        <span id="val-x">0</span> (Left/Right)
    </div>
    <div class="control">
        <label>Y</label>
        <input type="range" min="-10" max="10" step="0.1" value="0" oninput="updatePos('y', this.value)" />
        <span id="val-y">0</span> (Up/Down)
    </div>
    <div class="control">
        <label>Z</label>
        <input type="range" min="-10" max="10" step="0.1" value="-1" oninput="updatePos('z', this.value)" />
        <span id="val-z">-1</span> (Front/Back)
    </div>

    <script src="spatialAudio.js"></script>
    <script>
        const audioManager = new SpatialAudioManager();
        const MANUAL_TAG_ID = 'manual';
        const pos = { x: 0, y: 0, z: -1 };

        async function initAudio() {
            if (audioManager.isAudioInit) return;
            await audioManager.init();
            // Create a persistent sound for manual control
            audioManager.createSound(MANUAL_TAG_ID, pos.x, pos.y, pos.z);
            // Set to continuous moving state for manual sliders
            audioManager.activeSounds[MANUAL_TAG_ID].isMoving = true;
        }

        // Update position in real-time
        function updatePos(axis, val) {
            document.getElementById(`val-${axis}`).innerText = val;
            pos[axis] = parseFloat(val);

            if (audioManager.isAudioInit) {
                audioManager.updateSoundPosition(MANUAL_TAG_ID, pos.x, pos.y, pos.z);
                // Force moving state so it stays continuous while using sliders
                audioManager.activeSounds[MANUAL_TAG_ID].isMoving = true;
            }
        }
    </script>
</body>

</html>